<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Rack | Admin Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="admin-style.css">
    <style>
        /* Additional CSS styles for validation indicators and error messages */
        .error-text { color: var(--danger); font-size: 11px; margin-top: 5px; display: block; min-height: 15px; }
        .password-rules { list-style: none; padding: 0; margin: 10px 0; font-size: 11px; }
        .rule { color: #888; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .rule i { font-size: 14px; }
        .rule.valid { color: #2E7D32; }
        .btn-submit:disabled { background-color: #ccc !important; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .loader { display: none; width: 18px; height: 18px; border: 2px solid #ffffff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 0.8s linear infinite; margin-left: 10px; }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
    </style>
</head>
<body class="light-theme"> 

<nav class="navbar">
    <div class="logo-wrapper">
        <img src="logo-retro.png" alt="Retro Rack Logo" class="admin-logo">
    </div>
    <div id="themeToggle" style="cursor:pointer; display:flex; align-items:center; gap:10px; padding-right:20px;">
        <i class='bx bx-moon' id="themeIcon" style="font-size:24px;"></i>
        <span class="theme-text">Dark Mode</span>
    </div>
</nav>

<div class="auth-wrapper">
<div class="auth-container">
<div class="auth-header">
    <h1 id="authTitle">Admin Access</h1>
    <p id="authSubtitle">Please enter your credentials to manage your store.</p>
</div>

<!-- Login form for existing administrators -->
<form id="loginForm" class="auth-form" novalidate>
    <div class="input-group">
        <label>Email Address</label>
        <div class="field-wrapper">
            <i class='bx bx-envelope main-icon'></i>
            <input type="email" id="loginEmail" placeholder="admin@retrorack.com" required>
        </div>
        <small class="error-text" id="loginEmailError"></small>
    </div>

    <div class="input-group">
        <label>Password</label>
        <div class="field-wrapper">
            <i class='bx bx-lock-alt main-icon'></i>
            <input type="password" id="loginPass" placeholder="••••••••" required>
            <button type="button" class="password-toggle-btn" id="toggleBtnLogin">
                <i class='bx bx-hide' id="toggleIconLogin"></i>
            </button>
        </div>
        <small class="error-text" id="loginPassError"></small>
    </div>

    <button type="submit" class="btn-submit" id="loginBtn">
        <span class="btn-label">Sign In</span>
        <div class="loader" id="loginLoader"></div>
    </button>

    <div class="auth-switch">
        <span>New administrator? <a href="#" onclick="toggleAuth(true)">Sign Up Now</a></span>
    </div>
</form>

<!-- Registration form for new administrators -->
<form id="signupForm" class="auth-form hidden" novalidate>
    <div class="input-group">
        <label>Official Email</label>
        <div class="field-wrapper">
            <i class='bx bx-envelope main-icon'></i>
            <input type="email" id="regEmail" placeholder="name@domain.com" required>
        </div>
        <small class="error-text" id="regEmailError"></small>
    </div>

    <div class="input-group">
        <label>New Password</label>
        <div class="field-wrapper">
            <i class='bx bx-lock-alt main-icon'></i>
            <input type="password" id="regPass" placeholder="Minimum 8 characters" required>
        </div>
        <ul class="password-rules">
            <li class="rule" id="length"><i class='bx bx-circle'></i> Minimum 8 characters</li>
            <li class="rule" id="upper"><i class='bx bx-circle'></i> Uppercase & lowercase letters</li>
            <li class="rule" id="number"><i class='bx bx-circle'></i> Number & symbol</li>
        </ul>
        <small class="error-text" id="regPassError"></small>
    </div>

    <button type="submit" class="btn-submit" id="regBtn" disabled>
        Register Account
    </button>

    <div class="auth-switch">
        <span>Already have an account? <a href="#" onclick="toggleAuth(false)">Login</a></span>
    </div>
</form>

</div>
</div>

<script>
/* --- 1. THEME INITIALIZATION AND SESSION CHECK --- */
const body = document.body;

// Apply the saved theme preference from local storage
if (localStorage.getItem('theme') === 'dark') {
    body.classList.add('dark-theme');
}

/* --- 2. LOGIN PROCESSING LOGIC --- */
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const email = document.getElementById('loginEmail').value.trim().toLowerCase();
    const password = document.getElementById('loginPass').value;
    const emailError = document.getElementById('loginEmailError');
    const passError = document.getElementById('loginPassError');
    const loader = document.getElementById('loginLoader');

    // Clear any previous error messages
    emailError.innerText = "";
    passError.innerText = "";

    // Retrieve stored administrator credentials
    const storedEmail = localStorage.getItem('adminEmail');
    const storedPass = localStorage.getItem('adminPass');

    if (email === storedEmail && password === storedPass) {
        loader.style.display = "inline-block";
        document.getElementById('loginBtn').disabled = true;

        // Save login state
        localStorage.setItem('isLoggedIn', 'true');

        setTimeout(() => {
            window.location.href = 'dashboard.html';
        }, 1000);
    } else {
        passError.innerText = "Incorrect email or password.";
    }
});

/* --- 3. SIGN-UP VALIDATION LOGIC (STRICT RULES) --- */
const regEmail = document.getElementById('regEmail');
const regPass = document.getElementById('regPass');
const regBtn = document.getElementById('regBtn');

// Regular expressions for input validation
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
const passRegex  = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s]).{8,}$/;

// Validate sign-up inputs in real time
function validateSignup() {
    const isEmailValid = emailRegex.test(regEmail.value);
    const isPassValid = passRegex.test(regPass.value);

    updateRuleUI('length', regPass.value.length >= 8);
    updateRuleUI('upper', /[A-Z]/.test(regPass.value) && /[a-z]/.test(regPass.value));
    updateRuleUI('number', /\d/.test(regPass.value) && /[^\w\s]/.test(regPass.value));

    regBtn.disabled = !(isEmailValid && isPassValid);
}

// Update the password requirement indicators
function updateRuleUI(id, isValid) {
    const element = document.getElementById(id);
    element.classList.toggle('valid', isValid);
    element.querySelector('i').className =
        isValid ? 'bx bxs-check-circle' : 'bx bx-circle';
}

// Trigger validation when user types
regEmail.addEventListener('input', validateSignup);
regPass.addEventListener('input', validateSignup);

// Handle sign-up form submission
document.getElementById('signupForm').addEventListener('submit', function(e) {
    e.preventDefault();

    localStorage.setItem('adminEmail', regEmail.value.toLowerCase().trim());
    localStorage.setItem('adminPass', regPass.value);

    const container = document.querySelector('.auth-container');
    container.innerHTML = `
        <div style="text-align:center; padding:20px;">
            <i class='bx bxs-check-circle' style="font-size:60px; color:#2E7D32;"></i>
            <h2 style="margin-top:15px;">Account Successfully Created!</h2>
            <p>Please log in using your new credentials.</p>
            <button onclick="location.reload()" class="btn-submit" style="margin-top:20px;">
                Back to Login
            </button>
        </div>
    `;
});

/* --- 4. USER INTERFACE HELPER FUNCTIONS --- */

// Switch between login and sign-up forms
function toggleAuth(isSignup) {
    document.getElementById('loginForm').classList.toggle('hidden', isSignup);
    document.getElementById('signupForm').classList.toggle('hidden', !isSignup);
    document.getElementById('authTitle').innerText =
        isSignup ? "Create Account" : "Admin Access";
}

// Handle theme toggle interaction
document.getElementById('themeToggle').onclick = () => {
    body.classList.toggle('dark-theme');
    const isDark = body.classList.contains('dark-theme');
    document.getElementById('themeIcon').className =
        isDark ? 'bx bx-sun' : 'bx bx-moon';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
};

// Toggle password visibility for login input
document.getElementById('toggleBtnLogin').onclick = () => {
    const passwordInput = document.getElementById('loginPass');
    const isPassword = passwordInput.type === 'password';
    passwordInput.type = isPassword ? 'text' : 'password';
    document.getElementById('toggleIconLogin').className =
        isPassword ? 'bx bx-show' : 'bx bx-hide';
};
</script>

</body>
</html>